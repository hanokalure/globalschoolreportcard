<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maximus Report Card Generator Portal</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Header Section -->
    <div class="header-section">
        <div class="header-container">
            <div class="header-brand">
                <img src="images/logo.jpg" alt="Maximus Logo" class="brand-logo">
                <div class="brand-text">
                    <h1>Maximus Report Card Generator Portal</h1>
                    <p>Global's Sanmarg Public School - Professional Report Card Management System</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Progress Steps -->
    <div class="progress-container">
        <div class="steps-box">
            <h3 class="steps-title">🚀 Report Card Generation Process</h3>
            <div class="progress-steps">
                <div class="step active" data-step="1">
                    <div class="step-icon">🏫</div>
                    <div class="step-info">
                        <div class="step-title">Select Class</div>
                        <div class="step-subtitle">Choose class & academic year</div>
                    </div>
                </div>
                <div class="step" data-step="2">
                    <div class="step-icon">📝</div>
                    <div class="step-info">
                        <div class="step-title">Select Exam</div>
                        <div class="step-subtitle">Choose exam for the class</div>
                    </div>
                </div>
                <div class="step" data-step="3">
                    <div class="step-icon">👥</div>
                    <div class="step-info">
                        <div class="step-title">Select Student</div>
                        <div class="step-subtitle">Browse students in the class</div>
                    </div>
                </div>
                <div class="step" data-step="4">
                    <div class="step-icon">📋</div>
                    <div class="step-info">
                        <div class="step-title">Generate Card</div>
                        <div class="step-subtitle">View/download report card</div>
                    </div>
                </div>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" style="width: 25%"></div>
            </div>
        </div>
    </div>

    <!-- Main Content Container -->
    <div class="main-container">
        
        <!-- Step 1: Select Class -->
        <div class="step-content active" id="step1">
            <div class="step-header">
                <h2>🏫 Step 1: Select Class & Academic Year</h2>
                <p>Choose the class and academic year for generating report cards</p>
            </div>
            
            <div class="selection-grid">
                <div class="selection-group">
                    <h4>📅 Academic Year</h4>
                    <div class="input-group">
                        <label for="academicYear">Academic Year</label>
                        <select id="academicYear">
                            <option value="">Loading...</option>
                        </select>
                    </div>
                </div>
                
                <div class="selection-group">
                    <h4>🏫 Class Selection</h4>
                    <div class="input-group">
                        <label for="classSelect">Select Class</label>
                        <select id="classSelect" disabled>
                            <option value="">First select academic year</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <div class="class-info" id="classInfo" style="display: none;">
                <div class="info-card">
                    <h4>📊 Class Information</h4>
                    <div class="info-details">
                        <p><strong>Class:</strong> <span id="selectedClassName"></span></p>
                        <p><strong>Section:</strong> <span id="selectedClassSection"></span></p>
                        <p><strong>Academic Year:</strong> <span id="selectedAcademicYear"></span></p>
                        <p><strong>Total Students:</strong> <span id="totalStudents">Loading...</span></p>
                    </div>
                </div>
            </div>
            
            <div class="step-actions">
                <button class="btn btn-primary" id="nextToExams" disabled>Next: Select Exam →</button>
            </div>
        </div>
        
        <!-- Step 2: Select Exam -->
        <div class="step-content" id="step2">
            <div class="step-header">
                <h2>📝 Step 2: Select Exam</h2>
                <p>Choose the exam for which you want to generate report cards</p>
            </div>
            
            <div class="exam-selection">
                <div class="selected-class-info" id="selectedClassInfo">
                    <div class="info-card">
                        <h4>🏫 Selected Class</h4>
                        <div class="info-summary">
                            <p><span id="currentClassName">No class selected</span> - <span id="currentClassSection">-</span></p>
                            <p>Academic Year: <span id="currentAcademicYear">-</span></p>
                        </div>
                    </div>
                </div>
                
                <div class="exam-grid" id="examGrid">
                    <div class="loading-message">
                        <div class="loading-icon">⏳</div>
                        <h3>Loading Available Exams...</h3>
                        <p>Please wait while we fetch exams for the selected class</p>
                    </div>
                </div>
            </div>
            
            <div class="exam-info" id="examInfo" style="display: none;">
                <div class="info-card">
                    <h4>📝 Selected Exam Details</h4>
                    <div class="info-details">
                        <p><strong>Exam Name:</strong> <span id="selectedExamName"></span></p>
                        <p><strong>Start Date:</strong> <span id="examStartDate"></span></p>
                        <p><strong>End Date:</strong> <span id="examEndDate"></span></p>
                        <p><strong>Max Marks:</strong> <span id="examMaxMarks"></span></p>
                        <p><strong>Remarks:</strong> <span id="examRemarks"></span></p>
                    </div>
                </div>
            </div>
            
            <div class="step-actions">
                <button class="btn btn-secondary" id="backToClass">← Back</button>
                <button class="btn btn-primary" id="nextToStudents" disabled>Next: Select Student →</button>
            </div>
        </div>
        
        <!-- Step 3: Select Student -->
        <div class="step-content" id="step3">
            <div class="step-header">
                <h2>👥 Step 3: Select Student</h2>
                <p>Choose a student to generate their report card</p>
            </div>
            
            <div class="current-selection">
                <div class="selection-summary">
                    <div class="summary-card">
                        <h4>📝 Current Selection</h4>
                        <div class="summary-details">
                            <p><strong>Class:</strong> <span id="summaryClassName">-</span></p>
                            <p><strong>Academic Year:</strong> <span id="summaryAcademicYear">-</span></p>
                            <p><strong>Exam:</strong> <span id="summaryExamName">-</span></p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="students-search">
                <div class="search-box">
                    <input type="text" id="studentSearch" placeholder="Search students by name or roll number...">
                    <div class="search-icon">🔍</div>
                </div>
            </div>
            
            <div class="students-grid" id="studentsGrid">
                <div class="loading-message">
                    <div class="loading-icon">⏳</div>
                    <h3>Loading Students...</h3>
                    <p>Please wait while we fetch students for the selected class</p>
                </div>
            </div>
            
            <div class="students-summary" id="studentsSummary" style="display: none;">
                <p>Showing <span id="visibleStudentsCount">0</span> of <span id="totalStudentsCount">0</span> students</p>
            </div>
            
            <div class="step-actions">
                <button class="btn btn-secondary" id="backToExams">← Back</button>
                <button class="btn btn-primary" id="generateReportCard" disabled>Generate Report Card →</button>
            </div>
        </div>
        
        <!-- Step 4: Generate Report Card -->
        <div class="step-content" id="step4">
            <div class="step-header">
                <h2>📋 Step 4: Report Card Generated</h2>
                <p>Your report card is ready! You can view, print or download it as PDF</p>
            </div>
            
            <div class="report-card-display" id="reportCardDisplay">
                <div class="loading-message">
                    <div class="loading-icon">⏳</div>
                    <h3>Generating Report Card...</h3>
                    <p>Please wait while we generate the report card with marks from the database</p>
                </div>
            </div>
            
            <div class="actions-panel" id="actionsPanel" style="display: none;">
                <div class="actions-header">
                    <h4>🎯 Report Card Ready</h4>
                    <p>Your report card has been generated successfully</p>
                </div>
                <div class="print-section">
                    <button class="modern-print-btn" onclick="printReportCard()">
                        <div class="print-icon">🖨️</div>
                        <div class="print-content">
                            <span class="print-title">Print Report Card</span>
                            <span class="print-subtitle">High-quality print with school logo</span>
                        </div>
                    </button>
                </div>
            </div>
            
            <div class="step-actions">
                <button class="btn btn-secondary" id="backToStudents">← Back to Students</button>
                <button class="btn btn-primary" id="startOver">Start Over</button>
            </div>
        </div>
        
        
    </div>

    <div id="output"></div>
    
    <!-- Floating New Card Button -->
    <button class="floating-btn" id="floatingNewCard" onclick="generateNewCard()" style="display: none;" title="Generate New Card">
        <span class="floating-icon">✨</span>
        <span class="floating-text">New Card</span>
    </button>

    <template id="hallTicketTemplate">
        <div class="hall-ticket">
            <!-- Diamond Border Container -->
            <div class="diamond-border-frame">
                
                <!-- Header Section -->
                <div class="hall-ticket-header">
                    <div class="school-logo">
                        <img src="images/logo .jpg" alt="School Logo" class="logo-img">
                    </div>
                    <div class="school-info">
                        <h1 class="school-name">GLOBAL'S SANMARG PUBLIC SCHOOL BIDAR</h1>
                        <p class="school-subtitle">English Medium School With Shiksha-E-Hind and IIT Foundation Course</p>
                        <h2 class="exam-title">Marks Card Annual Exam (2020-21)</h2>
                    </div>
                </div>

                <!-- Student Information -->
                <div class="student-info">
                    <div class="student-left">
                        <div class="student-field">
                            <span class="field-label">STUDENT NAME:</span>
                            <span class="field-value student-name"></span>
                        </div>
                        <div class="student-field">
                            <span class="field-label">CLASS:</span>
                            <span class="field-value class"></span>
                        </div>
                        <div class="student-field">
                            <span class="field-label">ROLL NO:</span>
                            <span class="field-value roll-no"></span>
                        </div>
                    </div>
                    <div class="student-right">
                        <div class="student-field">
                            <span class="field-label">FATHER NAME:</span>
                            <span class="field-value father-name"></span>
                        </div>
                        <div class="student-field">
                            <span class="field-label">SECTION:</span>
                            <span class="field-value section"></span>
                        </div>
                    </div>
                </div>

                <!-- Marks Table -->
                <div class="marks-section">
                    <table class="marks-table">
                        <thead>
                            <tr>
                                <th>Subjects</th>
                                <th>Max.Marks</th>
                                <th>Min.Marks</th>
                                <th>Marks Obt.</th>
                                <th>Remark</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Mathematics</td>
                                <td>100</td>
                                <td>35</td>
                                <td class="math-marks">66</td>
                                <td class="math-remark"></td>
                            </tr>
                            <tr>
                                <td>Science</td>
                                <td>100</td>
                                <td>35</td>
                                <td class="science-marks">65</td>
                                <td class="science-remark"></td>
                            </tr>
                            <tr>
                                <td>Social</td>
                                <td>100</td>
                                <td>35</td>
                                <td class="social-marks">55</td>
                                <td class="social-remark"></td>
                            </tr>
                            <tr>
                                <td>English</td>
                                <td>100</td>
                                <td>35</td>
                                <td class="english-marks">66</td>
                                <td class="english-remark"></td>
                            </tr>
                            <tr>
                                <td>Kannada</td>
                                <td>100</td>
                                <td>35</td>
                                <td class="kannada-marks">69</td>
                                <td class="kannada-remark"></td>
                            </tr>
                            <tr>
                                <td>Hindi/Urdu</td>
                                <td>100</td>
                                <td>35</td>
                                <td class="hindi-marks">70</td>
                                <td class="hindi-remark"></td>
                            </tr>
                            <tr class="total-row">
                                <td><strong>Total</strong></td>
                                <td><strong>600</strong></td>
                                <td><strong>210</strong></td>
                                <td class="total-marks"><strong>396</strong></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><strong>Rank</strong></td>
                                <td colspan="4"></td>
                            </tr>
                            <tr class="percentage-row">
                                <td><strong>Percentage</strong></td>
                                <td colspan="3" class="percentage">66</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><strong>Grade</strong></td>
                                <td colspan="3" class="grade">B</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Co-Scholastic Areas -->
                <div class="co-scholastic">
                    <h3>Co-Scholastic Areas</h3>
                    <div class="co-scholastic-grid">
                        <div class="co-item">
                            <span>1. Discipline in the classroom</span>
                            <div class="grade-options">[ A / B / C ]</div>
                        </div>
                        <div class="co-item">
                            <span>2. Behavior / Conduct with teachers & classmates</span>
                            <div class="grade-options">[ A / B / C ]</div>
                        </div>
                        <div class="co-item">
                            <span>3. Regularity & Neatness in doing HW/CW</span>
                            <div class="grade-options">[ A / B / C ]</div>
                        </div>
                        <div class="co-item">
                            <span>4. Comes to School: On time [ ] / Sometimes Late [ ] / Always Late [ ]</span>
                            <div class="grade-options"></div>
                        </div>
                    </div>
                </div>

                <!-- Footer Signatures -->
                <div class="signatures">
                    <div class="signature-item">
                        <div class="signature-line"></div>
                        <strong>Parent Sign</strong>
                    </div>
                    <div class="signature-item">
                        <div class="signature-line"></div>
                        <strong>Class Teacher</strong>
                    </div>
                    <div class="signature-item">
                        <div class="signature-line"></div>
                        <strong>Academic Head</strong>
                    </div>
                </div>
                
                <div class="diamond-border-bottom"></div>
            </div>

            <!-- Download Section -->
            <div class="download-section">
                <button class="print-btn" onclick="printHallTicket(this)">🖨️ Print</button>
                <button class="view-btn" onclick="viewHallTicket(this)">👁️ View PDF</button>
                <button class="download-btn" onclick="downloadHallTicket(this)">📥 Download PDF</button>
            </div>
        </div>
    </template>

    <script src="script.js"></script>
    
</body>
</html>
